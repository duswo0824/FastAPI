<html>
<head>
<meta charset="UTF-8">
<title>detail</title>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<style>
	table,th,td{
    border: 1px solid black;
    border-collapse: collapse;
	padding: 5px 10px;
	}
</style>
</head>
<body>
	<table>
			<tr>
				<th>제목</th>
				<td id="subject"></td>
			</tr>
			<tr>
				<th>작성자</th>
				<td id="user_name"></td>
			</tr>
			<tr>
				<th>작성일</th>
				<td id="reg_date"></td>
			</tr>
			<tr>
				<th>조회수</th>
				<td id="bhit"></td>
			</tr>
			<tr>
				<th>내용</th>
				<td id="content"></td>
			</tr>
			<tr id="photo">
				<th>사진</th>
				<td></td>
			</tr>
			<tr>
				<th colspan="2">
					<input type="button" value="리스트" onclick="location.href='list.html'"/>
					<input type="button" value="수정" onclick="updateForm"/>
				</th>
			</tr>
		</table>
</body>
<script>
	// location.search -> ?idx=4
	// split : 가른다의 의미
	const idx = location.search.split('=')[1]; // [?idx=4]
	console.log(idx);

	function updateForm(){
		location.href='updateForm.html?idx='+idx;
	}

	$.ajax({
			url:'/detail?idx='+idx,
			type:'get',
			data:{},
			dataType:'JSON',
			success:function(obj){
				console.log(obj);
				if(obj.login == ''){
					alert('로그인이 필요한 서비스 입니다.');
					location.href = '/'; // main으로
				}
				$('#subject').html(obj.post.subject)
				$('#user_name').html(obj.post.user_name)
				$('#reg_date').html(obj.post.reg_date)
				$('#bhit').html(obj.post.b_hit)
				$('#content').html(obj.post.content)

				if(obj.photos.length > 0){
					let content = '';
					for(photo of obj.photos){
						content += '<img src="/upload/'+photo.new_filename+'" width="200"/><br/>';
					}
					$('#photo td').html(content);
				}else{
					$('#photo').hide();
				}
				
			},
			error:function(err){
				console.log(err);
			}
		});
</script>
</html>